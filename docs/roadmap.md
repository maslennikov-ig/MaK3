# **Обновленная Дорожная карта разработки MaK CRM (2025) – Соло \+ ИИ**

## **Введение**

Данная дорожная карта является детальным планом разработки и внедрения CRM-системы MaK CRM. Она основана на Техническом Задании (ТЗ) и "Дополнении к ТЗ для ИИ", и служит для отслеживания прогресса. План разделен на этапы с задачами, сроками и результатами, адаптированными для индивидуальной разработки с использованием AI-ассистента. Разработчик управляет процессом, ставя задачи ИИ, проводя ревью кода и интегрируя модули.

## **Общая информация**

* **Формат работы**: Проект разрабатывается индивидуально разработчиком (далее – "Разработчик") с активным использованием AI-ассистента для генерации, анализа и рефакторинга кода, а также для других вспомогательных задач. Разработчик выполняет роли Product Owner, архитектора, ревьюера кода, тестировщика и DevOps-инженера (на начальном этапе).  
* **Общая ориентировочная продолжительность проекта**: 12-18 месяцев (зависит от сложности непредвиденных задач и эффективности работы с ИИ).  
* **Методология разработки**: Итеративная разработка с фокусом на достижение ключевых вех. Рекомендуются регулярные (например, еженедельные или двухнедельные) циклы планирования, разработки с ИИ, ревью и тестирования.  
* **Технологический стек**:  
  * **Frontend**: Next.js (React, TypeScript, App Router), Mantine, TanStack Table, dnd-kit, Recharts/Nivo, React Hook Form, React Arborist (или аналог после проверки активности).  
  * **Backend**: NestJS (TypeScript), REST API (основной), опционально GraphQL для сложных запросов.  
  * **БД**: PostgreSQL (рекомендуется **Prisma ORM**), Redis, ElasticSearch, Object Storage (Яндекс.Облако или аналог).  
  * **Очереди**: BullMQ.  
  * **Real-time**: WebSockets (Socket.IO с адаптером Redis).  
  * **DevOps**: Docker, Docker Compose (для локальной разработки и начального этапа), Kubernetes (для продакшена, возможно, на более поздних этапах), CI/CD (например, GitHub Actions), Яндекс.Облако, Prometheus, Grafana, Sentry.  
* **Ключевые вехи**:  
  * MVP (Минимально жизнеспособный продукт): 6-8 месяцев.  
  * Бета-версия (с расширенным функционалом): 10-14 месяцев.  
  * Релиз: 12-18 месяцев.

## **Этап 0: Подготовка, планирование и настройка (3-4 недели)**

### **Задачи**

* **Глубокое** изучение ТЗ и "Дополнения к ТЗ **для ИИ"**: Формирование четкого видения продукта и процесса работы с ИИ.  
* **Настройка инфраструктуры разработки**:  
  * Создание репозитория (например, GitHub).  
  * Настройка базового CI/CD пайплайна (например, GitHub Actions для линтинга, тестов, сборки Docker-образов).  
  * Настройка локального окружения разработки с Docker Compose для всех сервисов (Frontend, Backend, PostgreSQL, Redis, Elasticsearch).  
  * Подготовка базовой инфраструктуры в Яндекс.Облаке (или выбранном провайдере) для будущих развертываний (например, управляемые БД, Object Storage).  
* **Детализация архитектуры и начальное проектирование**:  
  * Финализация высокоуровневой технической архитектуры.  
  * **Проектирование системы с учетом будущей архитектуры "Каталога компонентов"**: предусмотреть возможность подключения/отключения функциональных модулей Администратором системы. Основные модули изначально проектируются как независимые единицы.  
  * Проектирование схемы основной БД (PostgreSQL) с использованием Prisma Schema (если выбран Prisma). Создание начальных миграций.  
  * Проектирование базовых API эндпоинтов (OpenAPI/Swagger спецификации).  
  * Планирование структуры модулей для NestJS и Next.js.  
* **Выбор и настройка инструментов**:  
  * Настройка IDE для работы с TypeScript, NestJS, Next.js.  
  * Настройка ESLint, Prettier.  
  * Выбор и первичная настройка системы управления проектом/задачами (например, Trello, Jira, Notion).

### **Результаты**

* Настроенное локальное и базовое облачное окружение.  
* Финализированная архитектура для MVP, учитывающая модульность и будущий Каталог компонентов.  
* Начальная схема БД и миграции.  
* Настроенные инструменты разработки и CI.  
* Четкий план на первые спринты MVP.

## **Этап 1: Базовая CRM – Ядро и Пользователи (MVP Часть 1\) (8-10 недель)**

### **Спринт 1-2: Ядро Backend и Аутентификация (3-4 недели)**

* **Разработка ядра Backend (NestJS)**:  
  * Создание базовой структуры проекта NestJS, настройка модулей.  
  * Настройка Prisma ORM (или выбранной ORM) и подключение к PostgreSQL.  
  * Реализация базовой конфигурации (переменные окружения).  
  * Настройка логирования (интеграция с Sentry на базовом уровне).  
* **Аутентификация и Авторизация (RBAC \- основа)**:  
  * Реализация JWT аутентификации (регистрация, вход, выход, обновление токена).  
  * Создание базовых сущностей для Пользователей и Ролей. **Роли "Партнёр" и "Франчайзи" назначаются Администратором при создании пользователя.**  
  * Начальная реализация RBAC (гарды, декораторы) для защиты эндпоинтов. **Предусмотреть** механизм иерархии прав, позволяющий Партнёрам/Франчайзи управлять **правами своих сотрудников в рамках собственных полномочий.**  
  * Разработка API для управления пользователями (CRUD для администратора).  
* **Настройка Frontend (Next.js)**:  
  * Создание базовой структуры проекта Next.js с App Router.  
  * Настройка Mantine (темизация light/dark, базовые layout-компоненты).  
  * Реализация страниц входа, регистрации.  
  * Интеграция с API аутентификации, управление состоянием сессии пользователя (например, NextAuth.js или кастомное решение).

### **Спринт 3-4: Управление Клиентами и Лидами (3-4 недели)**

* **Backend (NestJS)**:  
  * Проектирование и реализация моделей данных для Клиентов и Лидов (с учетом полей из ТЗ 2.2).  
  * Разработка API для CRUD операций с Клиентами и Лидами (с учетом RBAC).  
  * Реализация логики для источников клиентов, статусов.  
  * API для загрузки/выгрузки клиентов (базовый CSV/Excel).  
* **Frontend (Next.js)**:  
  * Разработка интерфейса для просмотра списка клиентов/лидов (TanStack Table с базовой фильтрацией/сортировкой).  
  * Формы для создания/редактирования клиентов/лидов (React Hook Form \+ Mantine).  
  * Отображение истории изменений, комментариев, управление вложениями (интеграция с Object Storage).  
* **Интеграция Elasticsearch (начальная)**:  
  * Настройка Elasticsearch и его интеграция с NestJS.  
  * Индексация данных клиентов/лидов для базового поиска.

### **Спринт 5: Базовое управление Сделками и Воронками (2-3 недели)**

* **Backend (NestJS)**:  
  * Проектирование и реализация моделей данных для Сделок и Воронок продаж (ТЗ 2.3).  
  * API для CRUD операций со Сделками, привязка к клиентам.  
  * API для управления этапами воронок.  
* **Frontend (Next.js)**:  
  * Базовый интерфейс для отображения сделок (список/карточки).  
  * Возможность создания/редактирования сделок.  
  * Начальная реализация канбан-доски (Mantine \+ dnd-kit) для управления этапами сделок (без сложной автоматизации на этом этапе).

### **Результаты Этапа 1 (MVP Часть 1\)**

* Рабочее ядро системы с аутентификацией и базовым RBAC, учитывающим роли "Партнёр"/"Франчайзи" и иерархию прав для управления ими своими сотрудниками.  
* Функционал управления клиентами, лидами (создание, просмотр, редактирование, базовый импорт/экспорт, поиск).  
* Базовый функционал управления сделками и воронками (создание, просмотр, перемещение по этапам).  
* Развернутая версия на тестовом стенде в Яндекс.Облаке.

## **Этап 2: Ключевые Интеграции и Единый Кабинет для Внешних Пользователей (MVP Часть 2\) (8-10 недель)**

### **Спринт 6-7: Интеграция с AmoCRM (3-4 недели)**

* **Backend (NestJS)**:  
  * Глубокий анализ API AmoCRM, определение сценариев двусторонней интеграции (ТЗ 2.6).  
  * Разработка модуля интеграции: маппинг полей, логика синхронизации клиентов, сделок, статусов.  
  * Использование BullMQ для асинхронной обработки задач синхронизации.  
* **Frontend (Next.js)**:  
  * Интерфейс для настройки и управления интеграцией с AmoCRM администратором.  
  * Отображение статуса синхронизации.

### **Спринт 8: Telegram-бот (2-3 недели)**

* **Backend (NestJS)**:  
  * Разработка Telegram-бота (например, с использованием telegraf или node-telegram-bot-api).  
  * Реализация базовых команд: уведомления о новых клиентах/сделках, просмотр информации (ТЗ 2.6).  
  * Интеграция с системой аутентификации для безопасного доступа к данным через бота.  
* **Frontend (Next.js)**:  
  * Интерфейс для администратора для управления настройками Telegram-бота.

### **Спринт 9-10: Единый Кабинет для Внешних Пользователей (Партнёры/Франчайзи) (основа) (3-4 недели)**

* **Backend (NestJS)**:  
  * Доработка RBAC для поддержки ролей "Партнёр" и "Франчайзи" (определяемых при создании пользователя Администратором). Обеспечение строгого разделения доступа к данным на основе роли и принадлежности (согласно ТЗ 2.1, 2.4, 2.5).  
  * Разработка API, предоставляющего данные для Единого Кабинета, с логикой, адаптирующей ответ в зависимости от роли пользователя (Партнёр/Франчайзи).  
  * API для управления Партнёрами/Франчайзи своими сотрудниками (создание, назначение прав в рамках своих полномочий).  
* **Frontend (Next.js)**:  
  * Проектирование и разработка базовой структуры Единого Кабинета.  
  * Реализация механизма автоматического определения отображаемого функционала в Едином Кабинете на основе роли пользователя (Партнёр/Франчайзи) после аутентификации.  
  * Разработка общих компонентов интерфейса для кабинета.  
  * Реализация условного рендеринга разделов и функциональности в зависимости от роли пользователя (например, раздел "Аукцион лидов" и "Взаимодействие с брокерами" для франчайзи; "Реферальная программа" для партнёров, если она специфична).  
  * Начальное отображение списков клиентов/лидов и сделок, отфильтрованных для данного пользователя и его роли.  
  * Базовая аналитика, доступная в кабинете, с учетом роли пользователя.  
  * Реализация интерфейса для Партнёров/Франчайзи по созданию и управлению своими сотрудниками, включая назначение им ролей и прав доступа (в пределах собственных прав Партнёра/Франчайзи).  
  * *Примечание:* Реализация WebSocket клиента для real-time отслеживания статусов заявок для пользователей с ролью "Франчайзи" в Едином Кабинете запланирована на Этап 3\.

### **Результаты Этапа 2 (MVP Часть 2\)**

* Рабочая двусторонняя интеграция с AmoCRM.  
* Функциональный Telegram-бот с базовыми возможностями.  
* Базовая версия Единого Кабинета для Внешних Пользователей (Партнёров и Франчайзи), предоставляющая доступ к релевантным данным и функциям в зависимости от роли пользователя, включая управление своими сотрудниками.  
* MVP системы готов к внутреннему тестированию и демонстрации.

## **Этап 3: Real-time, Фоновые задачи и Расширенный UI/UX (6-8 недель)**

### **Спринт 11: Real-time отслеживание статусов заявок (2-3 недели)**

* **Backend (NestJS)**:  
  * Разработка WebSocket Gateway (Socket.IO) для обновлений статусов (согласно "Дополнению к ТЗ для ИИ", Задача 1.1).  
  * Настройка WebSocket адаптера для Redis (Задача 1.2).  
* **Frontend (Next.js)**:  
  * Реализация WebSocket клиента в Едином Кабинете для пользователей с ролью "Франчайзи" для динамического отображения обновлений (Задача 1.3).

### **Спринт 12: Система фоновых задач и очередей (2-3 недели)**

* **Backend (NestJS/Redis)**:  
  * Интеграция BullMQ для управления очередями (согласно "Дополнению к ТЗ для ИИ", Задача 2.1).  
  * Разработка сервисов-продюсеров и обработчиков задач для уведомлений, автоматизаций воронки (базовых), задач интеграций (Задачи 2.2, 2.3).  
  * Настройка UI для мониторинга очередей (Задача 2.4).

### **Спринт 13: Расширенный UI/UX (Drag\&Drop, Inline-редактирование) (2-3 недели)**

* **Frontend (Next.js)**:  
  * Реализация Drag\&Drop для канбан-доски сделок (dnd-kit) (ТЗ 2.3).  
  * Реализация Inline-редактирования в таблицах (TanStack Table) (ТЗ 2.3).  
  * Доработка трехколоночного интерфейса для сделок (ТЗ 2.3).  
  * Улучшение адаптивности и общей отзывчивости интерфейса.

### **Результаты Этапа 3**

* Функционал real-time обновления статусов для пользователей с ролью "Франчайзи" в Едином Кабинете.  
* Надежная система фоновых задач для уведомлений и других асинхронных операций.  
* Улучшенный UI/UX с интерактивными элементами (drag\&drop, inline-edit).

## **Этап 4: Аналитика, Сложные UI и Безопасность (8-10 недель)**

### **Спринт 14-15: Аналитика, Отчёты и Дашборды (3-4 недели)**

* **Backend (NestJS/PostgreSQL/Elasticsearch)**:  
  * Разработка API для встроенных отчетов (воронка продаж, эффективность и т.д. \- ТЗ 2.9), с учетом фильтрации данных для Единого Кабинета.  
  * Проектирование и реализация API для "Конструктора отчётов" (согласно "Дополнению к ТЗ для ИИ", Задача 3.B.3).  
* **Frontend (Next.js)**:  
  * Разработка интерфейса для встроенных отчетов с визуализацией (Recharts/Nivo), адаптированного для Единого Кабинета.  
  * Реализация интерфейса "Конструктора отчётов" (Задача 3.B.1).  
  * Разработка настраиваемых дашбордов (базовая версия).

### **Спринт 16: Визуальный редактор автоматизаций (начальная версия) (2-3 недели)**

* **Frontend (Next.js)**:  
  * Разработка интерфейса визуального редактора автоматизаций (согласно "Дополнению к ТЗ для ИИ", Задача 3.A.1) – фокус на базовых действиях и условиях.  
* **Backend (NestJS)**:  
  * Определение JSON-структуры для правил автоматизации (Задача 3.A.2).  
  * Начальная реализация механизма исполнения простых правил автоматизации (Задача 3.A.3).

### **Спринт 17: Безопасность и Соответствие ФЗ-152 (2-3 недели)**

* **Backend & Frontend**:  
  * Внедрение двухфакторной аутентификации (SMS, email, Telegram – ТЗ 2.10).  
  * Интеграция с внешними сервисами авторизации РФ (Госуслуги и др. – ТЗ 2.10).  
  * Реализация аудита действий пользователей (логирование в PostgreSQL/Elasticsearch).  
  * Проверка и доработка системы на соответствие требованиям ФЗ-152 (шифрование, обработка ПД).  
  * Проведение базового аудита безопасности, настройка security headers (helmet).

### **Результаты Этапа 4**

* Функционал аналитики с встроенными отчетами и базовым конструктором, доступный в Едином Кабинете с учетом прав.  
* Начальная версия визуального редактора автоматизаций.  
* Усиленная безопасность, реализована 2FA и базовое соответствие ФЗ-152.  
* Система готова к более широкому бета-тестированию.

## **Этап 5: Формализация Каталога Компонентов, Разработка Интерфейса Управления и Подготовка к Расширению (6-8 недель)**

*Данный этап фокусируется на создании формализованной системы управления дополнительными и опциональными компонентами/модулями. Основные же функциональные блоки системы (Клиенты, Сделки и т.д.), разрабатываемые на предыдущих этапах, изначально проектируются с учетом принципов модульности, чтобы обеспечить их независимость и возможность будущего включения в общую систему управления компонентами, если это потребуется.*

### **Спринт 18-19: Архитектура и Реализация Каталога Компонентов (4-5 недель)**

* **Архитектура, Backend (NestJS), Frontend (Next.js)**:  
  * Проектирование API и контрактов для компонентов Каталога (согласно "Дополнению к ТЗ для ИИ", Задача 4.1).  
  * Реализация бэкенд-поддержки (управление, конфигурации) (Задача 4.2).  
  * Реализация фронтенд-поддержки (динамическая загрузка, UI управления компонентами *для Администратора* (активация/деактивация, базовая настройка)) (Задача 4.3).  
  * Разработка 1-2 пилотных компонентов для каталога (например, простой виджет для дашборда, базовый отчет).

### **Спринт 20: Документация для разработчиков компонентов и API (2-3 недели)**

* **Документация**:  
  * Создание документации по API Каталога компонентов (Задача 4.4).  
  * Разработка гайдлайнов и примеров для создания новых компонентов.  
  * Финализация и публикация основной документации API системы (Swagger/OpenAPI – ТЗ 2.6, 4.6).  
  * Подготовка базовых руководств пользователя (ТЗ 4.6).

### **Результаты Этапа 5**

* Рабочая архитектура Каталога компонентов с возможностью подключения новых модулей и интерфейсом управления для Администратора.  
* Несколько пилотных компонентов в каталоге.  
* Документация для разработчиков компонентов и основное API.

## **Этап 6: Опциональный GraphQL, Оптимизация и Финальная Документация (4-6 недель)**

### **Спринт 21: Рассмотрение и Реализация GraphQL (если принято решение) (2-3 недели)**

* **Анализ, Backend (NestJS), Frontend (Next.js)**:  
  * Проведение анализа целесообразности GraphQL для сложных запросов (согласно "Дополнению к ТЗ для ИИ", Задача 5.1).  
  * Если решение положительное: разработка GraphQL API, интеграция клиента, документирование (Задачи 5.2, 5.3, 5.4).

### **Спринт 22: Оптимизация, Подготовка к расширению, Финальная документация (2-3 недели)**

* **Оптимизация**:  
  * Профилирование производительности бэкенда и фронтенда, устранение узких мест.  
  * Оптимизация запросов к БД и Elasticsearch.  
* **Подготовка к расширению (ТЗ 4.7)**:  
  * Финализация best practices и гайдлайнов по разработке.  
  * Подготовка инфраструктуры к возможному будущему масштабированию (обзор настроек Kubernetes, если используется).  
* **Документация**:  
  * Завершение всех руководств пользователя и технической документации (ТЗ 4.6).  
  * Создание обучающих материалов (базовых).

### **Результаты Этапа 6**

* Принято решение по GraphQL (и реализовано, если нужно).  
* Оптимизированная производительность системы.  
* Полный комплект документации.  
* Система готова к широкому бета-тестированию и последующему релизу.

## **Этап 7: Бета-Тестирование и Доработка (4-6 недель)**

### **Спринты 23-24 (или более, по необходимости):**

* **Развертывание бета-версии** на выделенном стенде.  
* **Привлечение ограниченного числа реальных пользователей** (пользователи с ролями "Партнёр" и "Франчайзи", внутренние сотрудники) для тестирования.  
* **Активный сбор и анализ обратной связи** (через формы, интервью, систему трекинга ошибок).  
* **Итеративная доработка**: исправление выявленных ошибок, улучшение UI/UX на основе фидбека, оптимизация.  
* **Приоритизация доработок** для релиза.

### **Результаты Этапа 7**

* Стабильная бета-версия системы, протестированная на реальных сценариях.  
* Список доработок и исправлений для релиза.

## **Этап 8: Релиз и Начальная Поддержка (2-4 недели \+ постоянно)**

### **Спринт \~25 (или по готовности):**

* **Подготовка к релизу**: финальное тестирование, подготовка миграций данных (если нужны), создание релизных сборок.  
* **Развертывание продакшн-версии** на основной инфраструктуре.  
* **Мониторинг запуска**: активный мониторинг системы в первые дни/недели после релиза.  
* **Обучение пользователей** (если еще не проводилось или требуются дополнительные сессии).  
* **Запуск в эксплуатацию**.

### **Постоянная поддержка и развитие (после релиза):**

* **Техническая поддержка**: реагирование на инциденты, исправление ошибок.  
* **Развитие функциональности**: сбор требований, планирование и реализация новых версий и компонентов.  
* **Оптимизация и масштабирование** по мере роста нагрузки и потребностей.

